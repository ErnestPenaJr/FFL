<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/fontawesome-pro-5.15.4/css/all.css">
<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" href="node_modules/dropzone/dist/dropzone.css">

<div class="my-auto mx-auto">
    <table id="ledger" class="table table-striped table-hover table-bordered table-sm">
        <thead>
            <tr>
                <th>ID</th>
                <th>JOURNAL</th>
                <th>TRANSACTION DATE</th>
                <th>TRANSACTION TYPE</th>
                <th>VENDOR ID</th>
                <th>VENDOR NAME</th>
                <th>EMPLID</th>
                <th>PURCHASE AMOUNT</th>
                <th>DEPTID</th>
                <th>FUND GROUP</th>
                <th>FUND TYPE</th>
                <th>FUND</th>
                <th>PROJECT</th>
                <th>ACCOUNT</th>
                <th>PAYMENT TYPE</th>
                <th>REQUISITION NUM</th>
                <th>PO</th>
                <th>DESCRIPTION</th>
                <th>FILES</th>
                <th>RECONCILED</th>
                <th>STATUS</th>
            </tr>
        </thead>
        <tbody></tbody>

    </table>

</div>

<script src="node_modules/jquery/dist/jquery.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
<script src="assets/fontawesome-pro-5.15.4/js/fontawesome.js"></script>
<script src="node_modules/aos/dist/aos.js"></script>
<script src="node_modules/jszip/dist/jszip.js"></script>
<script src="node_modules/datatables.net/js/jquery.dataTables.js"></script>
<script src="node_modules/datatables.net-bs5/js/dataTables.bootstrap5.js"></script>
<script src="node_modules/datatables.net-buttons/js/dataTables.buttons.js"></script>
<script src="node_modules/datatables.net-buttons-bs5/js/buttons.bootstrap5.js"></script>
<script src="node_modules/pdfmake/build/pdfmake.js"></script>
<script src="node_modules/pdfmake/build/vfs_fonts.js"></script>
<script src="node_modules/datatables.net-buttons/js/buttons.html5.js"></script>
<script src="node_modules/xlsx/dist/xlsx.full.min.js"></script>
<script src="node_modules/moment/moment.js"></script>
<script src="node_modules/dropzone/dist/dropzone.js"></script>
<script src="assets/js/script.js"></script>

<script>
    $(document).ready(function() {
        loadLedger()
    });
    function loadLedger(){

        var ledger = $("#ledger").DataTable({
            "ajax": "assets/CFCs/functions.cfc?method=getFFL",
            "columns": [
                {"data": "FFL_ID"},
                {"data": "JOURNALNUMBER"},
                {"data": "TRANSACTION_DATE"},
                {"data": "TRANSACTION_TYPE"},
                {"data": "VENDOR_ID"},
                {"data": "VENDOR_NAME"},
                {"data": "EMPLID"},
                {"data": "PURCHASE_AMOUNT"},
                {"data": "DEPTID"},
                {"data": "FUND_GROUP"},
                {"data": "FUND_TYPE"},
                {"data": "FUND"},
                {"data": "PROJECT"},
                {"data": "ACCOUNT"},
                {"data": "PAYMENT_TYPE"},
                {"data": "REQUISITION_NUM"},
                {"data": "PO"},
                {"data": "DESCRIPTION"},
                {"data": "RECEIPTS"},
                {"data": "RECONCILED"},
                {"data": "STATUS"}
            ],
            "order": [[0, "asc"]],
            "paging": true,
            "ordering": true,
            "info": true,
            "searching": true,
            //"scrollY": "550px",
            "scrollCollapse": true,
            "paging": true,
        pageLength: 10,
        lengthMenu: [10, 25, 50, 75, 100],
        dom: 'Bfrtip',
        buttons: [
        { 
            className: 'mb-2',
                text: 'Add New', action: function ( e, dt, node, config ) {
                    $('.title').html('');
                    // Logic for adding a new record
                    if ($('#ID').val() != '') {
                        $('#CFS_ID').html('');
                        $('#FELLOW').val('');
                        $('#DESCRIPTION').val('');
                        $('#START_DATE').val('');
                        $('#END_DATE').val('');
                        $('#SUBMISSION_STATUS').val();
                        $("input").attr("disabled",true);
                        $("textarea").attr("disabled",true);
                    }
                    $('#loadModal').modal('show');
                    $('#save').show();
                    $('#update').hide();
                    $('#soft_delete').hide();
                }
                
            },{ 
                className: 'mb-2',
                text: 'Download Excel',
                action: function(e, dt, node, config) {
                    var originalData = dt.rows().data().toArray();
                    if (originalData.length === 0) return;
                    var excludeKeys = ['CREATEDBYDATE', 'ENTEREDBYID', 'UPDATEDDATE', 'UPDATEDBYID', 'PRIMARY_BALANCE'];
                    var data = originalData.map(function(obj) {
                        var newObj = Object.assign({}, obj);
                        excludeKeys.forEach(function(key) {
                            delete newObj[key];
                        });
                        return newObj;
                    });
                    var headers = ['ID', 'CFS_ID', 'FELLOW', 'DESCRIPTION', 'START_DATE', 'END_DATE', 'SUBMISSION_STATUS'];
                    var wb = XLSX.utils.book_new();
                    var ws = XLSX.utils.json_to_sheet(data, { header: headers });
                    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                    XLSX.writeFile(wb, 'PRS-Funds.xlsx');
                }
            },{
                    extend: 'pdfHtml5',
                    text: 'Save PDF',
                    className: 'mb-2',
                    orientation: 'landscape', // Optional: landscape or portrait
                    pageSize: 'A4', // Optional: 'A3', 'A5', 'A4', 'LEGAL', 'LETTER' etc.
                    title: 'PRS Funds', // Optional: Title for the PDF
                    exportOptions: {
                        columns: [0, 1, 2, 3, 4, 5, 6], // Specify the columns you want to export
                    }
                }
        ],
        dom: "Blrtip",
        select: true
        });
    }
</script>